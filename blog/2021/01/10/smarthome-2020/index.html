<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://blog.popstas.ru/blog/2021/01/10/smarthome-2020/"><meta property="og:title" content="Мой умный дом 2020: камера, голос, экранчики, кофеварка, сигарета с WiFi, умная банка"><meta property="og:image" content="https://blog.popstas.ru/images/2020/home-zones.jpg"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#2b5797"><meta name=theme-color content="#ffffff"><title>Мой умный дом 2020: камера, голос, экранчики, кофеварка, сигарета с WiFi, умная банка - projects</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=https://blog.popstas.ru/css/custom.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://blog.popstas.ru/favicon.png rel=icon><link href=http://feeds.feedburner.com/popstas rel=alternate type=application/rss+xml title=RSS><meta name=description content><meta name=keywords content="projects,smart home,nodejs,python,node-red,sonoff,tasmota,yandex-dialogs,esp8266,mqtt"><meta name=author content="Stanislav Popov"><meta name=generator content="Hugo 0.66.0"></head><body><header role=banner><hgroup><div class=site-title><a href=https://blog.popstas.ru/><img src=/favicon.png alt=popstas> Popstas</a></div><div></div></hgroup><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value;">
<option value>Navigate…</option></select></fieldset><ul class=main-navigation></ul><ul class=subscription><a href=http://feeds.feedburner.com/popstas target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank><fieldset role=search><input class=search type=text name=q results=0 placeholder="Поискать в Google">
<input type=hidden name=q value=site:https://blog.popstas.ru/></fieldset></form></nav></header><div id=main><div id=content><div><article class=hentry role=article itemscope itemtype=http://schema.org/Article><meta itemprop="author publisher" content="Stanislav Popov"><meta itemprop=mainEntityOfPage content="https://blog.popstas.ru/blog/2021/01/10/smarthome-2020/"><header><h1 class=entry-title itemprop=headline>Мой умный дом 2020: камера, голос, экранчики, кофеварка, сигарета с WiFi, умная банка</h1><p class="meta header-date">10.01.2021, 09:30 - 15 мин читать</p></header><div class=entry-content itemprop=articleBody><p><img src=/images/2020/home-zones.jpg alt="Дом, поделенный на зоны"></p><div class=contents data-header=h2><div>Оглавление:</div><ul class=contents-data></ul></div><hr><p>Что было год назад - <a href=/blog/2019/12/02/smarthome-node-red-2019/>Мой умный дом 2019: Sonoff, ESP8266, MQTT, Node-red, Алиса</a></p><h2 id=способы-управления>Способы управления</h2><ul><li><strong>Автоматика</strong> - идеальный вариант, когда делается само</li><li><strong>Голос</strong> - доступно в любом месте квартиры, без рук</li><li><strong>Выключатели</strong> - приклеиваются на скотч или просто кладутся в подходящих местах</li><li><strong>Радиопульты</strong> - пульт 4х3 см удобно положить в карман домашней одежды</li><li><strong>Приложение</strong> - доступно на ПК и на телефоне</li><li><strong>Telegram</strong> - можно писать Алисе через Telegram, она передаст умному дому</li><li><strong>HTTP, MQTT</strong> - низкоуровневые протоколы управления</li></ul><h2 id=примеры-автоматики>Примеры автоматики</h2><table><thead><tr><th>Что произошло</th><th>Что сделал дом</th></tr></thead><tbody><tr><td>Я включил тёплый пол за компом и ушёл на кухню</td><td>Тёплый пол выключается</td></tr><tr><td>Я сказал: &ldquo;Начинай медитацию&rdquo;</td><td>Свет выключается, включается таймер на 20 минут. Можно спрашивать: &ldquo;Сколько осталось?&rdquo;</td></tr><tr><td>Я сказал: &ldquo;Засеки время&rdquo;</td><td>Включится отсчёт времени. Вывод на экранчик в каждой комнате. Можно справшивать: &ldquo;Сколько прошло?&rdquo;</td></tr><tr><td>Я включил дома вечером телефон на зарядку</td><td>Телефон уточнит, ложусь ли я спать, выключит свет, включит будильник и поставит таймер на 15 минут</td></tr><tr><td>Камера видит больше одного человека</td><td>Включается режим гостей</td></tr><tr><td>Я пошёл вечером на балкон</td><td>Свет в комнате выключается</td></tr><tr><td>Я выключил будильник</td><td>Включается свет, через 2 минуты начинается зарядка</td></tr></tbody></table><h2 id=компьютерное-зрение>Компьютерное зрение</h2><p>Я поставил камеру и научил её распознавать местоположение людей на кадре.</p><p>Камера видит почти всю квартиру: комнату, кухню и часть коридора. Выглядит это так:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3fBrL_LCZMDBaXIQJtJPBw91AlB44L-OJ03KuBCwiVSlqayuMgH6sZosGeXl66tHEiOUNVycw80h0HiQRYfDvK4_iMsqHu8FqillqZ3WcFZQS8WMkYq7qTIywkPa_-5BOzw2XYSJqL7PbhPHcV_lPTrzw=w1280-h720-no?authuser=0" title="Камера видит комнату, кухню и часть коридора" alt="Камера видит комнату, кухню и часть коридора"></p><p>У камеры есть знание о 5 зонах в квартире:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3faN2h3Wm0du317UwBccELN5AVxfdR5pQsUgYbiHCn8j32bE3WP3xUsnk1r5ig8yemN6NK1JlUfdmCPmLWK8IKdyxVF4QrbO65C3FvtZOYqLpAKnXssZlKVfP4jvsMNOakLvEwr-MmoLSKBPZaUfwQFMg=w1280-h720-no?authuser=0" title="Камера видит комнату, кухню и часть коридора" alt="Камера видит комнату, кухню и часть коридора"></p><p>Каждую секунду камера распознаёт картинку и выдаёт мои координаты. Картинка для распознавания именно такая маленькая, 300х300 пикселей, этого хватает, чтобы хорошо распознавать людей и не путать с кошками:</p><img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3dCZuUP4P1f4LyvIgc_1nicsUHYuzYaAyCn-yX7Q8vkFQC3Fcs6dd9JwLpJiPK0joXtA13Uv9TvA0dfBiLODYkzQVOFuhqQ3Y5LnaPxwtwopsAWGoaVu70lAu0-qdbM1ExLzoTznmYwX-G75kro4idbog=s300-no?authuser=0" title="Камера видит меня за компом" alt="Камера видит меня за компом"><p>Так умный дом узнаёт, где сейчас находятся люди и может, например, выключить свет в комнате, где нет людей.</p><h3 id=ночное-зрение>Ночное зрение</h3><p>Камера имеет инфракрасную подсветку, с ней она может видеть комнату в темноте.</p><p>На фото видно, как камера распознаёт меня в коридоре, в полной темноте:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3cRyyxYqm8vRkM_7ddwzuDuibYrqpZ2TVhI5eK9S5mphTURnK39FiMWLE2_6ZwVMXJaCPWYhD8hsTpX6JM53vgDU8r-G-f1ZxpV3KKILO9f1RxaRJtKSGZ-g3wAhWZTM-wEdUux6UaqwTNsywJzMNbO3w=s300-no?authuser=0" title="Ночное видение комнаты" alt="Ночное видение комнаты"></p><p>До кухни ИК-подсветка не добивала, поставил на кухню инфракрасных диодов, для камеры это как освещение люстры, а глазу не видно.</p><p>На этом фото по-прежнему в квартире выключен свет, но кухня хорошо видна:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3fPYWV6N7ZyfDg4zdVH7XCslP9M4sOIQdwQzsPG5BSf2ic2JrVbe8tErVYZEYOHVgEUYD6E7gsGLi_t2y5Zlp_sdjpMxP3SWh3vbvKTvSeCQd6jFUTuEIWSUZSGLmVOsP2j0qEqVRG4e40rnMYRVDn81g=s300-no?authuser=0" title="Ночное видение кухни" alt="Ночное видение кухни"></p><h3 id=нейросеть-vs-кошка>Нейросеть vs Кошка</h3><p>Весной кошка начала ссать в коридоре, я сначала ведро ставил в том месте, пару месяцев помогало, потом перестало помогать.</p><p>Написал распознавалку кошки, поставил вторую камеру с видом на коридор.</p><p>Теперь, когда кошка идёт в место, где гадит, мой строгий голос из колонки говорит ей, что я всё вижу. Это срабатывает, но не всегда, камера без ночного видения, поэтому кошка пользуется этим и под покровом ночи делает свои грязные дела.</p><p>Проект пришлось свернуть из-за трудности обучения камеры распознавать срущую кошку. Но этого хватило, чтобы кошка одумалась и начала хорошо себя вести.</p><img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3exU3rIlGDDjIlrdLzEC2lv4QoCzeItKcv5QZ3BQMpfuG7Pz-Zs356uvZnFuVFczmos53ngYhcy8YjIYD6eINa_2cP8eLjJ9-3JWjQ7lFgr-mu38dRZqSpK2os--3QyFg080ISLP1JDkm7EifHIkbepGA=s300-no?authuser=0" title="Кошка detected" alt="Кошка detected"><p>Технически распознавание работает на дообученной модели <a href=https://github.com/librahfacebook/Detection/blob/master/object_detection/g3doc/detection_model_zoo.md>SSD MobileNet v1 COCO</a>. На датасете из 500 фоток начала работать хорошо. Несколько раз дообучал.</p><h2 id=помидор>Помидор</h2><p><a href=https://github.com/popstas/mongoose-mqtt-ssd1306>popstas/mongoose-mqtt-ssd1306</a></p><p>В июне начал постоянно использовать <a href=https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%BF%D0%BE%D0%BC%D0%B8%D0%B4%D0%BE%D1%80%D0%B0>метод помидора</a>. Для этого сделал голосовое управление и аппаратный экранчик.</p><p>В видео показано 3 способа управления таймером: голос, команды по сети и панель умного дома:</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/du_pAQib9QU style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>Помидор можно ставить на любое количество минут и использовать как таймер.</p><h2 id=экранчики-с-цифрами>Экранчики с цифрами</h2><p>После проекта с помидором у меня появился маленький экранчик перед глазами.</p><p>Позже он научился показывать:</p><ul><li>Время с таймеров (я что-то засёк или принтер печатает)</li><li>Непрочитанные в Планфиксе</li><li>Курс доллара</li><li>Котировки акций</li><li>Температуру в квартире</li></ul><p>Сделал второй такой же экранчик, поставил на кухне. Вывод на экран дублируется.</p><p>Экран в комнате крупным планом (размер около 25х20 мм):
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3dd9Ng2Jdq713vsFqqTrNT6j_nyH3mFsRAzPbIAzWvDoRkiKSW2MIQOxrtpPVab4e9BElcL_Rlr8eGT68R7ZBnLCHpnHHJNRcd8JadddrxpVVClu1iOnkxPUQXOx-7OoNDmeEtH0xyg7NkEI8VF0oJRXQ=w1423-h1068-no?authuser=0" title="Экран в комнате" alt="Экран в комнате"></p><p>Экран на кухне, издалека:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3cNUDVfYqednzfMRGlszIYtYiRTsRVHnL4BJK-T0NeIUD3HEo98DhBickTu3tpRNXnAuJVtD_0G0-UMXA1DZBs1lv4KPjS3I1SoLOImPR7xftmGXchSXuCSe_cHsLVnXsdxMAzv_cG0n-Wu1QQJ8W04Pg=w1423-h1068-no?authuser=0" title="Экран на кухне" alt="Экран на кухне"></p><h2 id=освещение>Освещение</h2><h3 id=светодиодная-лента>Светодиодная лента</h3><p>Раньше лента висела как попало:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3dUMY1PfJrSTgeokm1HaEZDJymGxLZcK1pPVR4BFWcPzHHZIfHZqfg2_BEbukPlTFoXfeB6BypY3Q-e1DIglBlofGZURZ2IIfVmH4l-ikqI_7nasZvBMaWeFup-bz2NlJ5RpRI_XShOQp7wTkNlRmKbhQ=w1423-h1068-no?authuser=0" title="Раньше лента висела как попало" alt="Раньше лента висела как попало"></p><p>Напечатал крепления на 3D принтере:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3f6Y4kl4nZX0yaCVZN4IkgObySJoljnBSss2zSLKDnek_R7WMG7sz2nEh2apEekvMIuP0Dx6SJlFJ5lgmP-jA0cqzS22lYRNXiC8Pk0S1jGQGG7g6jnR8BzutwtLVa153o4c_i5n_7Aw-hlOzdpqzvS5g=w1423-h1068-no?authuser=0" title="Теперь лента висит аккуратно" alt="Теперь лента висит аккуратно"></p><img loading=lazy src alt><h3 id=светильник-затмение>Светильник &ldquo;Затмение&rdquo;</h3><p>Увидел на Youtube красивый светильник:<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/XKThQvOV9-Q style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></p><p>Через 2 часа у меня появился похожий:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3fkSPN0VCySg4ET81rSWpjeV6XpDnra-BwR3reDcu6sXtKpPXtZMsQ9pn073KMKc5L1ek7JtcT4Nwfulpd9SPhkmJFbvEzdt7eAuR9rXgMog45Iqi2FaWF_04VfZgPSAowOgqML96U_AFncKSJor5a6-g=w1423-h1068-no?authuser=0" title="Светильник Затмение" alt="Светильник Затмение"></p><p>Прошивка - <a href=https://github.com/arendst/tasmota>Tasmota</a>.</p><p>Светильник работает в паре с лентой на противоположной стене.</p><p><a href=https://photos.app.goo.gl/yZFfPWtQ8Z2hYaT27>Другие фото и видео светильника</a></p><h3 id=яркость-люстры>Яркость люстры</h3><p>Осенью слетела прошивка на люстре (теперь и такое бывает). Купил на замену не просто реле, а диммер с регулировкой яркости.</p><p>Оставил диоды основным светом (включается автоматом когда надо), а люстру можно включить только голосом. Но если менять яркость через Алису (&ldquo;Яркость на 100%"), меняется сразу весь свет.</p><p><a href=https://photos.app.goo.gl/VFzo5TBqARBXTtKs6>Видео процесса тестирования диммера Sonoff D1</a></p><h2 id=умный-дом-говорит-через-алису>Умный дом говорит через Алису</h2><p><a href=https://github.com/AlexxIT/YandexStation>AlexxIT/YandexStation</a></p><p>Проект AlexxIT помог настроить озвучку событий (TTS) в умном доме через колонки, голосом Алисы.</p><h3 id=озвучка-через-ближайшее-устройство>Озвучка через ближайшее устройство</h3><p>Если умный дом знает, что я в комнате или на кухне, он произнесёт текст только соответствующей колонкой.</p><p>В телефоне озвучка происходит всегда (на Android настроил TTS через вебхуки MacroDroid).</p><h3 id=озвучка-входящих>Озвучка входящих</h3><p>Сделал озвучку того, кто звонит на телефон.</p><p>Сделал озвучку сообщений из мессенджеров. Если сообщение короче 100 символов, то Алиса зачитает, из какого приложения, кто и что написал.</p><p>Иногда это удобно, иногда не очень, в панели управления умным домом есть переключатель подробности озвучки. Когда гости приходят, озвучка сообщений отключается.</p><h2 id=3d-принтер>3D принтер</h2><p>Сценарий:</p><ol><li>Говорю &ldquo;Алиса, включи принтер&rdquo;</li><li>Принтер включается, ставится на прогрев</li><li>Когда нагреется, Алиса напоминает, что можно начинать печатать</li><li>После этого нажимаю &ldquo;Печать&rdquo; в программе</li><li>При завершении печати Алиса напомнит ещё раз</li></ol><p>Теперь принтер подключен к сети, что это даёт:</p><ul><li>Можно включить принтер и отправить модель на печать из другой комнаты</li><li>Умный дом говорит, когда принтер готов печатать. Принтеру надо около 5 минут на прогрев, за которые про него легко забыть</li><li>Информация о времени печати (можно спросить: &ldquo;Сколько осталось печатать&rdquo;, за минуту до конца печати напоминание)</li></ul><p>Принтером управляет <a href=https://octoprint.org/>Octoprint</a>, он добавил новых фич:</p><ul><li>Связь с умным домом по MQTT</li><li>Автонагрев при вклчении принтера</li><li>Автоотключение</li><li>Более точное время печати</li><li>Картинка с вебкамеры с процессом печати</li><li>Просмотр 3D модели будущей 3D модели</li><li>Более удобное выравнивание столика</li></ul><p>Я купил USB микроскоп, он идеально подошёл как камера для принтера: ручной фокус, штатив, подсветка вокруг камеры. Я напечатал крепление и прицепил камеру прямо на столик, теперь можно идеально выставить фокус и смотреть на неподвижную модель:</p><img loading=lazy src="https://lh3.googleusercontent.com/Zx27Kw7fpD-EOZMzy_JYqAxgT_vcWYtKTpkoeB16GVKHNmgs4bPEE4p7KC5EfAyohccp0UOR2943rfWHIejLFEtPWIs7zYUAasg7MA40MujE_rx7OY7qSB9Ut7slrk0bOmdUZQyfdZIhmqxCTYqc0OyOoicKZf_t-k0YlnruG0yU7RenagXpsP5mq83v8rsqaBGHiinMZEJOt4ny7wzBXFKl29uGuHh9-UWRVmI-DNYZ22ldhbhrnwbVp7TJSS-vRQm75HNSeJQcVcWzKwL74JU8Lqn_lXbqtkq9sdgztJIvfHvlfFcyi5rRYOpLsxGDZoWJf83rJyElUiNHPIdUAlmh0sOVwQYy8IErWHL4hzZ__6UFsvPvopY95f4I3P0zsWR3-gVjom1vTaTpbBHSmXs2HdTP-NdML3eUi7_2JxlCQQxumuMqYtu5DaIC_li4hvptpXg4oSrfD5GTt-eEbqD-Rd6W80K-cRxowm8SD1PN2Wxp0F3jOpvJpdtByZvDLseR-zueagtJtxQydPhhkPgzUsSXUMHV-uWYsYMecYYpReqdXHz84dkeqcvHuK6gHE1LkJWXVTL-HZU85OtopFTDBUp_vdql84nnWNqYuDpcyeUxhvPiMBy04MdlhjB_klwsm0a8NHQI7tdsYLo15NfhJYndwgCNg7NWtPIlhZ0tOGorzfH77bsX5HMLRA=w1423-h1068-no?authuser=0" title="Микроскоп крепится на столик принтера" alt="Микроскоп крепится на столик принтера"><p><a href=https://photos.app.goo.gl/SscMuLh8HUViM2GAA>Альбом 3D принтера и напечатанных моделей</a></p><h2 id=связка-устройств-с-алисой-по-mqtt>Связка устройств с Алисой (по MQTT)</h2><p><a href=https://github.com/popstas/yandex-dialogs-smarthome-mqtt>popstas/yandex-dialogs-smarthome-mqtt</a></p><p>Новые фичи:</p><ul><li>Не только выключатели, но и <a href=https://yandex.ru/dev/dialogs/alice/doc/smart-home/concepts/device-types.html>другие устройства, предусмотренные Яндексом</a></li><li>Поддержка датчиков</li></ul><p>После этого стал добавлять устройства:</p><h3 id=управление-компьютером>Управление компьютером</h3><p>Комп подключил к MQTT через <a href=https://iotlink.gitlab.io>IOT Link</a>, настроил несколько команд:</p><ul><li>Вкл/выкл (спящий режим и WakeOnLAN)</li><li>Управление громкостью</li><li>Переключение звука (колонки/наушники)</li><li>Включение музыки (сценарий запускает Яндекс.Музыку и через 5 секунд нажимает пробел)</li></ul><h3 id=управление-компьютером-20>Управление компьютером 2.0</h3><p><a href=https://github.com/popstas/windows-mqtt>popstas/windows-mqtt</a></p><p>Этот проект вырос из <a href=https://github.com/popstas/mqtt2tts>mqtt2tts</a>, для управления компом (громкость, клавиатура, озвучка сообщений).</p><p>IOT Link написан на C#, он глючный, я не знаю язык и не могу дописывать. Проще было написать на NodeJS свою версию и добавить регуляцию громкости.</p><h3 id=телевизор>Телевизор</h3><p><a href=https://github.com/hobbyquaker/lgtv2mqtt>hobbyquaker/lgtv2mqtt</a></p><p>Телевизор LG на WebOS подключил к MQTT, к Алисе (вкл/выкл, громкость, пауза).</p><h2 id=mi-box-tv>Mi Box TV</h2><p>Купил приставку с одной целью: смотреть ютуб за обедом на скорости 1.5. Нашёл больше плюсов:</p><ol><li><p>Видео по запросу включить очень просто - <a href="https://photos.google.com/share/AF1QipNxjlqgI2T0jouqM6Gw31LHnoCkHrdmKReW3LDNAGnlqqXrYmkeaVgWl60desgS9w/photo/AF1QipOM7BkndSwB5dewLIQtyRbT6dYIyUub-Edegxb8?key=djdoRTVNU3dCYVkyaGQ2VkRGMDloeEZHMWxoUy1B">видео</a></p></li><li><p>Смотришь видос на 2 часа, решил другим заняться, нажал одну кнопку &ldquo;выкл&rdquo;, ушёл. Возвращаешься, нажимаешь &ldquo;вкл&rdquo;, плей и видос продолжается</p></li><li><p>Он запоминает скорость ютуба, я по умолчанию на 1.5 смотрю и задолбался на телефоне каждый раз переключать. Теперь, через мибокс, узнал про альтернативный ютуб клиент, который умеет запоминать - <a href=https://github.com/yuliskov/SmartTubeNext>SmartTubeNext</a></p></li><li><p>Скорость. По сравнению со встроенным SmartTV можно в 3 раза быстрее включить что-то на Кинопоиске и в 5 раз быстрее на Youtube.</p></li></ol><h2 id=умная-кофеварка>Умная кофеварка</h2><p><a href=https://github.com/popstas/mongoose-redmond-rcm-1512-mqtt>popstas/mongoose-redmond-rcm-1512-mqtt</a></p><p>Купил новую кофеварку Redmond RCM-1512, заметил, что у неё управление электронное, значит можно управлять.</p><p>Сделал модуль, который умеет принимать команды от умного дома и нажимать на кнопки &ldquo;вкл&rdquo; и &ldquo;кофе&rdquo;.</p><p>Теперь кофе можно наливать через Алису:<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/kQxe32HY0Xw style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></p><p>Но наливать кофе голосом не очень удобно. Основной сценарий, ради которого всё затевалось:</p><ol><li>Я ставлю рожок с кофе и кружку, нажимаю <strong>одну</strong> кнопку</li><li>Кофеварка включается и кипятит воду</li><li>Автомат нажимает кнопку &ldquo;кофе&rdquo;, наливается полкружки</li><li>Автомат ещё раз нажимает кнопку &ldquo;кофе&rdquo;, наливается остальное</li><li>Через 5 минут кофеварка выключается</li></ol><p>Если бы мне сказали, сколько времени у меня уйдёт на этот проект, я бы не стал делать :)</p><p><a href=https://photos.app.goo.gl/dDUXBvTUNANDWNST6>Фото и видео процесса</a></p><h2 id=умная-электронная-сигарета>Умная электронная сигарета</h2><p>Захотел посчитать, сколько затяжек в день я делаю. Для этого использовал такую платку, размер 18х20 мм:
<img loading=lazy src="https://lh3.googleusercontent.com/948vOI8VuQzJWEJsSOZrVVVXRWJpW0vLABswVz5japwprUz60itFgTvfK1VxG4WhQMYEzcfJd9RA3hRaXoLHgNUHP-1303fiVtU4-H2YkpyzmSxA2JBKP3sH0GtBP74FFLZloEJDY3KqLpBq7B8LbcvpUT_O4DOSl8xZk42L0b5bkQ3hWvb0K1tnhyTyStovrjtDhReDoBLK-DcuRYAZLbd833Ny3psNnEmhHAX9grYfwF9S7bwJzxoD52zRXN3Z8_TFPiUkE9RMt-mB0vOmpexHw6uL7cKQs47tyn8FQG_mKSOOZ_CC7wyyGnt3MnJxBEJlC1aaPVvDUOHTG7Ma19sBy1DdakP7AoSRvtwSnc_t7KKqsqc4uCBDzsvufZi4kHHSrcM8POoD7nyL42NwP5V6LkZV_zRfH_D7ux3hq4PPulcO5RWKWi1lHEC2ZYgeEQG3MhDE8_H4PUSWlTAULE0qjtBFVxJgCmuN-NvMUbkuPgmL-w7bSiheYZvDZAMPYta_SxIrohs5nAf0H8OYG2qy78eWMqqHgbDs2o5rp8DwTAvPc7NFwWN6jeVpIi_nBVJCtmNCDzZyaFxa7UQe6fMB5t4pxkMtfIZSfzlECkSxmbpU9qd_VH69Ci_2zJN_msthD__D12TiSwY9obINx4YFIuqK9v_PJ1dMJyxLk-jl-3WumK6-KIaT7k62fQ=w1423-h1068-no?authuser=0" title=ESP-M3 alt=ESP-M3></p><p>Удивительное время: можно за 200 рублей купить микрокомпьютер с WiFi и засунуть в сигарету.</p><h2 id=умная-банка>Умная банка</h2><p>Захотел сделать автоматическую наливалку питьевой воды. Зачем это может быть нужно:</p><ul><li>Поставить наливать и уйти</li><li>Пополнять кофеварку без снимания бака</li><li>Наливать воду, когда мойка занята посудой (некуда поставить чайник)</li></ul><p>Банка включается голосом (&ldquo;Алиса, налей чайник&rdquo; - сработает), либо кнопкой (каждое нажатие +500 мл).</p><p>Технически банка состоит из USB насоса, реле Sonoff TH16 (подойдёт любое реле), блока питания и трёхлитровки. Поставил прошивку <a href=https://github.com/arendst/tasmota>Tasmota</a>, логику дописал в Node-RED.</p><p>Насадка на конце шланга нужна, чтобы крепить шланг на край ёмкости, гайка - чтобы напор не выбил шланг.</p><p><a href=https://photos.app.goo.gl/UR2eiwtBDWsBghi49>Альбом умной банки</a></p><img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3f45ecIeHcYiK7jkIMmQwApKtQlblTnhIUSI5r6bfO08cyeP9bQzjV1LTBYcxsP46ZXh_dNQndtaRyyrVEFmvobH3xpq5RhnFuzXG27Q2CK1KUhS3xqYGBOfoFKPAchlhrN3dL7ZuDsuFWmED88WHwAeA=w923-h1230-no?authuser=0" title="Умная банка" alt="Умная банка"><h2 id=вывод-данных-умного-дома-на-график>Вывод данных умного дома на график</h2><ul><li>Перемещения по квартире</li><li>Где когда горел свет</li><li>Когда был сон, зарядка, обед, медитация, работа, игра на гитаре</li><li>Изменения температуры</li><li>Изменения освещённости</li><li>Потребление электричества (для пары устройств)</li><li>Потребление никотина</li><li>График появления и решения личных задач</li></ul><p>График сна за неделю:
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3cwTiAG4-4fxPTf3H7vWr6-buVgdyvaLCz3AzbaLzWJu0inKjKvT4NmZgll_huUycJYa1OHVQpd9_3LupCBRvqCBxIHxeuGfV0fVrcgvwkWrwyv-N-CE5Wo0zizQQ2UJkqxVcDuHrSgnujqn-DV_rJ2ZQ=w1065-h1230-no?authuser=0" title="График сна за неделю" alt="График сна за неделю"></p><p>График задач, видно, что полоска постоянно растёт (новые задачи добавляются), а закрашенная часть под контролем (активные задачи):
<img loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3c1sNSQ8X_LJ1Als4F3mBKXtvr2cWKCf31eT-rumeojBmSozB61gcwWsH46_R1bDTWVQT3tCepOFcVfi15MOsc6xaeUgjcniDXWwJzFvPzjKdWYlUkUTQQgbRPTcJdrFZvBD6b5SpTm_8PJuq8ro59alA=w1035-h624-no?authuser=0" title="График задач" alt="График задач"></p><p>Технически MQTT передаётся в InfluxDB через Telegraf и выводится на Grafana.</p><h2 id=прочее>Прочее</h2><h3 id=датчик-освещения>Датчик освещения</h3><p><a href=https://github.com/popstas/mongoose-button>popstas/mongoose-button</a></p><p>Поменял датчик освещения с простого фоторезистора на спец. датчик MAX44009 (GY-49), он показывает освещение конкретно в люксах.</p><p>Зачем: чтобы умный дом лучше понимал, когда стемнело.</p><p>Чувствительность на 1-2 порядка выше, чем у фоторезистора. Раньше показания были 0-100%, где 100% - свечу фонариком в резистор.</p><p>Теперь при искусственном свете показывает 3-4, на рассвете 10, солнечным утром (10 утра 30 марта) - 100, в 11:40 уже 400, в 12:40 был пик, 640 люмен. Если светить фонариком, различает даже среднюю и высокую яркость мощной велофары, на максимуме показывает 180000!</p><p>Фоторезистор выполнял свою функцию, но для него солнечный свет и свет люстры были примерно одинаковыми, а для люксометра искусственный свет - почти ноль, это больше совпадает с восприятием.</p><p>В сочетании с камерой, которая срабатывает за секунду, это включает освещение ещё до того, как я об этом подумаю.</p><h3 id=бесконтактный-термометр>Бесконтактный термометр</h3><p><a href=https://github.com/popstas/mongoose-mlx90614>popstas/mongoose-mlx90614</a></p><p>Давно хотел термометр, чтобы можно было измерить температуру плиты, паяльника.</p><p>Купил по акции датчик MLX90614 (GY-906), пришлось опускаться до чтения документации от датчика и написания низкоуровневого кода: обращение к регистрам памяти датчика по шине I2C. <a href=https://github.com/popstas/mongoose-mlx90614/blob/master/fs/init.js#L28-L30>Эти 3 строчки</a> я писал несколько часов.</p><p>Датчик показывает +-5 градусов, если поднести почти вплотную, меня устроило.</p><h3 id=мелкие-интеграции-с-алисой-через-приватный-навык>Мелкие интеграции с Алисой через приватный навык</h3><p>Написал свой приватный навык, практически копия <a href=https://alexstar.ru/>Кузи</a>, но на js и без умного дома, берёт команды из yml, типа такого:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#66d9ef>match</span>: [засеки время, засечь время]
  <span style=color:#66d9ef>type</span>: mqtt
  <span style=color:#66d9ef>topic</span>: actions/timer/start
  <span style=color:#66d9ef>answer</span>: [ок, засекла, ладно]

- <span style=color:#66d9ef>match</span>: сколько прошло
  <span style=color:#66d9ef>type</span>: node-red
  <span style=color:#66d9ef>path</span>: timer/get
</code></pre></div><p>Приватному навыку можно дать любой голос и фразы активации. Я назвал просто &ldquo;дом, сервер, центр&rdquo;, теперь буду сам себе фразы хостить, без Домовёнка Кузи.</p><h4 id=что-умеет>Что умеет:</h4><ul><li>Сделай кофе</li><li>Добавь событие в Планфикс</li><li>Сколько градусов на кухне</li><li>Добавь задачу на сегодня</li></ul><h3 id=интеграция-strava-и-mqtt-вывод-тренировок-на-график>Интеграция Strava и MQTT: вывод тренировок на график</h3><p><a href=https://github.com/popstas/strava-mqtt>strava-mqtt</a></p><p>Программа не имеет интерфейса, просто раз в час проверяет новые тренировки на strava и отправляет эти данные в MQTT.</p><h3 id=home-assistant>Home Assistant</h3><p>Поставил Home Assistant, наконец нашёл причину: под него есть плагин, который позволяет рулить колонками. Это позволило:</p><ul><li>Настроить автоматическое изменение громкости колонки в течение дня, до этого часто менял голосом по несколько раз в день</li><li>Настроить TTS через колонки, то есть мой умный дом теперь может включить любую из колонок и произнести любую фразу</li></ul><h3 id=прибрался-в-mqtt>Прибрался в MQTT</h3><p><a href=https://mqtt-explorer.com/>MQTT Explorer</a> помог найти ненужные данные.</p><h2 id=устройства-по-комнатам>Устройства по комнатам</h2><h3 id=коридор>Коридор</h3><p>Датчик движения и датчик открытия входной двери: в паре они определяют, когда я пришёл/ушёл из дома.</p><h3 id=туалет-и-ванная>Туалет и ванная</h3><p>Тут без изменений, стоят датчики за 200 рублей, которые включают свет на 1 минуту при любом движении. С системой умного дома не связаны.</p><h3 id=кухня>Кухня</h3><ul><li>Кофеварка</li><li>Экранчик</li><li>Датчик освещения</li><li>Датчик температуры на плите</li><li>Умная банка</li><li>Колонка с Алисой</li><li>3D принтер</li><li>Телевизор</li><li>Mi Box</li><li>ИК-подсветка</li><li>Ручной пылесос (<a href=https://photos.app.goo.gl/gL271Utx7roVkMtHA>его альбом</a>)</li></ul><h3 id=комната>Комната</h3><ul><li>2 светильника: настенные диоды и верхний свет</li><li>Датчики температуры, влажности, CO2, освещения</li><li>Тёплый пол</li><li>Компьютер</li><li>Экранчик</li><li>Колонка с Алисой</li></ul><h2 id=цены>Цены</h2><ul><li>Камера - 1800 руб</li><li>Мозги для кофеварки - 400 руб</li><li>Мозги для электронной сигареты - 200 руб</li><li>2 экранчика с мозгами - 600 руб</li><li>Xiaomi Mi Box TV - 4400 руб</li><li>Умная банка: насос 560 руб, остальное было</li><li>Бесконтактный термометр MLX90614 - 530 руб</li><li>Диммер Sonoff D1, для регуляции яркости люстры - 800 руб</li><li>Ручной пылесос - 1600 руб</li><li>ИК-подсветка кухни - 200 руб</li><li>Датчики освещения - 200 руб</li><li>Блоки питания - около 500 руб</li></ul><p>Итого около 12 000 рублей. Что-то куплено на потом и здесь не учтено.</p><p><a href=https://photos.app.goo.gl/dj21rK7NyyZp2ckV8>Фотоальбом умного дома 2020</a></p></div><footer><p class=meta><time itemprop=datePublished content="2021-01-10T09:30:00+0600">10 Jan 2021, 09:30</time>
<span class=categories>, теги:
<a class=category href=https://blog.popstas.ru/tags/projects>projects</a><meta itemprop=about content="projects"><a class=category href=https://blog.popstas.ru/tags/smart-home>smart home</a><meta itemprop=about content="smart home"><a class=category href=https://blog.popstas.ru/tags/nodejs>nodejs</a><meta itemprop=about content="nodejs"><a class=category href=https://blog.popstas.ru/tags/python>python</a><meta itemprop=about content="python"><a class=category href=https://blog.popstas.ru/tags/node-red>node-red</a><meta itemprop=about content="node-red"><a class=category href=https://blog.popstas.ru/tags/sonoff>sonoff</a><meta itemprop=about content="sonoff"><a class=category href=https://blog.popstas.ru/tags/tasmota>tasmota</a><meta itemprop=about content="tasmota"><a class=category href=https://blog.popstas.ru/tags/yandex-dialogs>yandex-dialogs</a><meta itemprop=about content="yandex-dialogs"><a class=category href=https://blog.popstas.ru/tags/esp8266>esp8266</a><meta itemprop=about content="esp8266"><a class=category href=https://blog.popstas.ru/tags/mqtt>mqtt</a><meta itemprop=about content="mqtt"></span></p><div class=sharing><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a href=https://www.addtoany.com/share></a><a class=a2a_button_vk></a><a class=a2a_button_twitter></a><a class=a2a_button_telegram></a><a class=a2a_button_whatsapp></a><a class=a2a_button_facebook></a></div><script>var a2a_config=a2a_config||{};a2a_config.locale="ru";a2a_config.color_main="undefined";a2a_config.color_border="undefined";a2a_config.color_link_text="undefined";a2a_config.color_link_text_hover="undefined";a2a_config.color_bg="undefined";a2a_config.color_arrow="undefined";a2a_config.color_arrow_hover="undefined";a2a_config.prioritize=["vk","twitter","telegram","whatsapp","facebook"];a2a_config.templates=a2a_config.templates||{};a2a_config.templates.whatsapp={text:'${title} - ${link}?utm_medium=messenger&utm_source=whatsapp'};a2a_config.templates.telegram={title:'',text:'${title} - ${link}?utm_medium=messenger&utm_source=telegram'};</script><script async src=https://static.addtoany.com/menu/page.js></script></div><p class=meta><div>Новее: <a class=related href=https://blog.popstas.ru/blog/2021/01/16/github-projects-2020/ title="Мои проекты 2020: умный дом, сканер сайтов, Тинькофф API, Яндекс.Метрика, аккорды, Планфикс">Мои проекты 2020: умный дом, сканер сайтов, Тинькофф API, Яндекс.Метрика, аккорды, Планфикс</a></div><div>Старее: <a class=related href=https://blog.popstas.ru/blog/2021/01/06/content-2020/ title="Мой контент 2020: книги, музыка, фильмы, подкасты, каналы">Мой контент 2020: книги, музыка, фильмы, подкасты, каналы</a></div></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><p><p>Обновления через <a href=https://tglink.ru/popstas_vk_wall>Telegram</a> или <a href=http://feeds.feedburner.com/popstas>RSS</a></p><p><a href=https://www.tinkoff.ru/sl/83wd1FGIcMR>Поблагодарить меня</a></p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank href=https://github.com/popstas/ title=https://github.com/popstas/><i class="fa fa-github fa-3x"></i></a><a target=_blank href=https://twitter.com/popstas/ title=https://twitter.com/popstas/><i class="fa fa-twitter fa-3x"></i></a><a target=_blank href="tg://resolve?domain=popstas" title=popstas><i class="fa fa-telegram fa-3x"></i></a><a target=_blank href=mailto:popstas@gmail.com title=popstas@gmail.com><i class="fa fa-at fa-3x"></i></a></li></ul><section class=even><div class=sidebar-title>Последние посты:</div><ul id=recent_posts><li class=post><a href=/navigator/>Навигатор</a></li><li class=post><a href=/blog/2021/01/25/barbara-oakli-dumay-kak-matematik/>Содержание книги Барбары Оакли «Думай как математик»</a></li><li class=post><a href=/blog/2021/01/17/new-year-2020/>Итоги 2020 года: таблица активностей, сон, еда, музыка, спорт</a></li><li class=post><a href=/blog/2021/01/16/github-projects-2020/>Мои проекты 2020: умный дом, сканер сайтов, Тинькофф API, Яндекс.Метрика, аккорды, Планфикс</a></li><li class=post><a href=/blog/2021/01/10/smarthome-2020/>Мой умный дом 2020: камера, голос, экранчики, кофеварка, сигарета с WiFi, умная банка</a></li><li class=post><a href=/blog/2021/01/06/content-2020/>Мой контент 2020: книги, музыка, фильмы, подкасты, каналы</a></li><li class=post><a href=/blog/2020/06/11/eliyahu-goldratt-kriticheskaya-cep/>Содержание книги Элияху Голдратта «Критическая цепь»</a></li><li class=post><a href=/blog/2020/05/20/den-arieli-predskazuemaya-irracionalnost/>Содержание книги Дэна Ариели «Предсказуемая иррациональность»</a></li><li class=post><a href=/blog/2020/04/16/books-70/>Мои книги: 7-й десяток: эволюция, продуктивность и дзен-буддизм</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2015-2021 Stanislav Popov -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io>Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/>Hugo-Octopress</a> theme.</p></footer><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WPJWVXB');</script><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/custom.js></script><script type=text/javascript>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(51681281,"init",{id:51681281,clickmap:true,trackLinks:true,accurateTrackBounce:true,webvisor:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/51681281 style=position:absolute;left:-9999px alt></div></noscript></body></html>
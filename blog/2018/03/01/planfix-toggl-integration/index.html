<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

  
  <title>Интеграция Планфикса и Toggl для учета времени</title>

  
  
  <link rel="stylesheet" href="https://blog.popstas.ru/css/hugo-octopress.css">

  
  
    <link rel="stylesheet" href="https://blog.popstas.ru/css/custom.css">
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://blog.popstas.ru/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Stanislav Popov">

  
  <meta name="generator" content="Hugo 0.51" />

  
  

</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://blog.popstas.ru/">Popstas</a></h1>
    <h2>Записки о Linux</h2>
</hgroup></header>


<nav role="navigation">

<ul class="main-navigation">
  
  
</ul>


<ul class="subscription">
  
    
        <a href="http://feeds.feedburner.com/popstas" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
    <p class="meta">1 Mar 2018, 20:30
         - 6 мин читать 

        
    </p>
    <h1 class="entry-title">
         Интеграция Планфикса и Toggl для учета времени 
    </h1>
</header>


        <div class="entry-content">
          
          
          
          <p>Прошло ровно 2 года с тех пор, как я сделал прошлую интеграцию <a href="/blog/2016/03/02/git-gitlab-planfix-integration/">Планфикса с Git</a>, так получилось, что я опять в отпуске и опять готов поделиться новой интеграцией.</p>

<p>Tl;dr: автоматическая отправка из Toggl в Планфикс через аналитики. Ссылки:</p>

<ul>
<li><a href="https://github.com/viasite/planfix-toggl-server" target="_blank">Описание</a></li>
<li><a href="https://github.com/viasite/planfix-toggl-server/releases" target="_blank">Ссылки на загрузки</a> (проверялось только под Windows и Linux)</li>
<li>Расширения для <a href="https://chrome.google.com/webstore/detail/toggl-button-planfix-edit/hkhchfdjhfegkhkgjongbodaphidfmcl" target="_blank">Chrome</a> и <a href="https://addons.mozilla.org/ru/firefox/addon/toggl-button-planfix/" target="_blank">Firefox</a></li>
</ul>

<p><img src="/images/2018-03/planfix-toggl.png" /></p>

<h2 id="toggl">Toggl</h2>

<p>Я постоянно пользуюсь Toggl с ноября 2015, так как у меня в рабочем дне бывает очень много переключений с одной задачи на другую (20-30 в день - обычное дело), Toggl стал для меня незаменимым инструментом для отслеживания того, на что сколько именно времени я потратил. Так как в нашей компании потраченное время напрямую влияет на зарплату и на стоимость для наших клиентов, учет времени для меня был довольно важен.</p>

<p>Еще до Toggl я делал <a href="/blog/2015/11/22/simple-time-tracker/">что-то похожее на него</a>, то ли не понял тогда, как им пользоваться, то ли там фич не хватало. В любом случае, ничего лучше Toggl для учета времени я не видел, хотя в последние годы и не искал, кто еще не пробовал, советую на него посмотреть - <a href="https://toggl.com" target="_blank">https://toggl.com</a></p>

<h2 id="планфикс">Планфикс</h2>

<p>Планфикс не имеет из коробки автоматической системы учета времени, если не считать <a href="https://planfix.ru/timer/" target="_blank">Таймера</a>, который не ложится под нашу систему учета времени: мы используем кастомные аналитики, а Таймер умеет ставить только Фактическое время работы.</p>

<p>В то же время, на форуме <a href="https://forum.planfix.ru/viewtopic.php?f=30&amp;t=1612" target="_blank">уже</a> <a href="https://forum.planfix.ru/viewtopic.php?f=30&amp;t=1209" target="_blank">не раз</a> <a href="https://forum.planfix.ru/viewtopic.php?f=30&amp;t=1354" target="_blank">поднималась</a> <a href="https://forum.planfix.ru/viewtopic.php?f=30&amp;t=2688" target="_blank">тема трекинга времени</a>, в частности, <a href="https://forum.planfix.ru/viewtopic.php?f=32&amp;t=4348" target="_blank">интеграцией с Toggl</a></p>

<p>Я же последние 2 года переносил данные из Toggl в Планфикс вручную, это было сравнительно легко, чтобы было еще проще, я написал <a href="https://github.com/viasite/userscript-planfixfix" target="_blank">небольшой юзерскрипт</a>, который сокращал ввод аналитики до пары кликов (не будет работать без дописывания под вас).</p>

<p>Схема была такая:</p>

<ul>
<li>если задача закончена, смотрю общее время в Toggl и сразу переношу в Планфикс, <a href="/blog/2016/03/02/git-gitlab-planfix-integration/">через коммит</a> или вручную</li>
<li>если задача вернулась в работу, считаю в уме, сколько я уже внес и сколько осталось</li>
<li>в конце месяца смотрю сумму по самым большим проектам, сравниваю с отчетом Планфикса и добавляю разницу</li>
</ul>

<p>В общем, так можно было и продолжать пользоваться, но это было не очень удобно, да и часть времени все равно не доходила до Планфикса.</p>

<h2 id="от-прототипа-до-сегодня">От прототипа до сегодня</h2>

<p>Я знал, что у Планфикса и Toggl есть API, что можно это все использовать и связать, но мне казалось это слишком сложным (так и оказалось :) и я не мог придумать, как связывать записи в Toggl с задачами в Планфиксе.</p>

<p>Но вот месяц назад звезды сошлись и я вдруг понял: нужно хранить в Toggl номер задачи, а назад отправлять через email! Чтобы номер задачи был отдельно и не мельтешил, я решил, что разумнее всего будет сделать его в виде тега.</p>

<p>Тем же вечером я пришел домой и за 3 часа написал <a href="https://github.com/viasite/planfix-toggl/blob/17627de92067302e5ad5deeb1ccc9e9814eacad5/renderer.js" target="_blank">рабочий прототип</a>: nodejs скрипт, который при запуске находит Toggl-записи с тегом из цифр, отправляет email на соответствующий адрес и отмечает в Toggl запись как отправленную добавлением к ней тега <code>sent</code>.</p>

<p>Следующую неделю я занимался ежедневным переписыванием с нуля проекта:</p>

<ol>
<li>NodeJS скрипт</li>
<li>Electron приложение</li>
<li>Express.js + серверный рендеринг twig</li>
<li>Express.js + Vue + OnsenUI</li>
</ol>

<p>Вечером переписывал, а днем использовал на работе последнюю рабочую версию.</p>

<p>В первые пару дней я понял, что теги с номером задач вручную ставить не очень удобно, поэтому я решился дописать официальное расширение Toggl для браузеров, чтобы прямо на странице задачи была кнопка Play, как положено. На удивление, это оказалось так просто, что я пожалел, что не сделал это давно. Естественно, я отправил <a href="https://github.com/toggl/toggl-button/pull/969" target="_blank">pull request</a>, который к сожалению был проигнорирован, как и другие недавние запросы интеграций. Если у вас есть github аккаунт и вы собираетесь пользоваться расширением, пожалуйста, оставьте палец вверх в пулл реквесте, может быть так быстрее примут, мне не хочется сопровождать два расширения.</p>

<p>К концу первой недели вся видимая часть уже выглядела почти так, как сейчас, но внутри было всё настолько прототипно, что кроме меня этим никто не мог пользоваться.</p>

<p>Потом я решил оставить web UI как есть, а серверную часть переписать на Go, который давно хотелось попробовать. Это разделило проект на 2 части: <a href="https://github.com/viasite/planfix-toggl-client" target="_blank">planfix-toggl-client</a> (web UI), <a href="https://github.com/viasite/planfix-toggl-server" target="_blank">planfix-toggl-server</a> (отправлялка и API для UI).</p>

<p>Через несколько дней я что-то сломал, и письма перестали доходить до Планфикса. Дело было в выходные, я решил, что письма стали попадать в спам. В тот день я решил отказаться от отправки письмами и переписать отправку на Планфикс API. Это в итоге добавило неделю, чтобы переписать на API без изменения остального. Конечно, API на Go для Планфикса никто не использовал, поэтому выделился еще один подпроект - <a href="https://github.com/popstas/planfix-go" target="_blank">planfix-go</a> (API для между отправлялкой и Планфиксом). API позволило настроить весь процесс, не используя обработку действий в Планфиксе, как я делал раньше, а сразу отправлять готовую аналитику с гарантией того, что она отправится и без необходимости указывать логин и пароль от своего ящика в конфиге.</p>

<p>После этого уже были мелкие доработки, чистка кода, добавление удобняшек, дальнейшая история есть в <a href="https://github.com/viasite/planfix-toggl-server/blob/master/CHANGELOG.md" target="_blank">CHANGELOG.md</a>.</p>

<p>Наконец, я вернулся к расширению браузера, до сих пор оно работало в режиме разработчика, чтобы этим мог пользоваться кто-то, кроме меня, нужно было опубликовать расширение официально, что я и сделал, оказалось тоже всё просто, и через час расширения для <a href="https://chrome.google.com/webstore/detail/toggl-button-planfix-edit/hkhchfdjhfegkhkgjongbodaphidfmcl" target="_blank">Chrome</a> и <a href="https://addons.mozilla.org/ru/firefox/addon/toggl-button-planfix/" target="_blank">Firefox</a> уже были доступны.</p>

<h2 id="планфикс-toggl">Планфикс + Toggl</h2>

<p>Что получилось в итоге, я постарался изложить в <a href="https://github.com/viasite/planfix-toggl-server" target="_blank">описании проекта</a>.</p>

<p>UI в общем-то сделан больше для интереса, для проверки того, что процесс запущен, но также выполняет одну удобную мне функцию: я могу из него перейти на страницу любой из последних 10-15 задач, над которыми я работал. В левой колонке указано количество сгруппированных записей (кол-во переключений), в правой - потраченное на задачу время, примерно как в Toggl, но с группировкой по задачам Планфикса.</p>

<p>Выглядит это так:</p>

<p><img src="/images/2018-03/planfix-toggl-server-ui.jpg" /></p>

<p>Остальной &ldquo;интерфейс&rdquo; довольно суров: конфиг для настройки и лог для обратной связи.</p>

<p>Как я использую planfix-toggl-server (не очень удачное название, решил не называть sender, вдруг еще что-то захочется добавить):</p>

<ul>
<li>Добавил программу в автозагрузку Windows через планировщик заданий</li>
<li>Программа работает на фоне и раз в час отправляет накопившиеся неотправленные записи</li>
<li>Новую задачу я начинаю в Планфиксе, через расширение, после этого переключаюсь на нее уже через Toggl (отправлялка уберет тег <code>sent</code> из активной записи, если вы вернулись к уже отправленной задаче)</li>
</ul>

<p>Что насчет отправки: способ через API доступен только для платных аккаунтов Планфикса, тут никакого заговора нет, просто так надежнее. По этой же причине отправка через email стала еще ненадежнее, т.к. я ей больше не пользуюсь.</p>

<p>Что насчет паролей: чтобы пользоваться отправлялкой, вам нужно будет внести свои ключи API от Планфикса и Toggl и логин с паролем от вашего юзера в Планфиксе, тут ничего секьюрного я не придумал (да и не пытался). Все исходники открыты, я могу только сказать, что никакие данные не отправляются никуда, кроме как по маршруту из Toggl в Планфикс, статистика не собирается (поэтому надеюсь получить обратную связь другими способами).</p>

<p>Конечно, проект такой, что вряд ли им сможет пользоваться не программист, но я постарался сделать всё просто, насколько возможно было сделать без написания полноценного UI и чтобы не делать больше того, что мне хотелось сделать. Буду рад, если кому-то еще это пригодится.</p>

<h2 id="код">Код</h2>

<ul>
<li><a href="https://github.com/viasite/planfix-toggl-server" target="_blank">https://github.com/viasite/planfix-toggl-server</a></li>
<li><a href="https://github.com/viasite/planfix-toggl-client" target="_blank">https://github.com/viasite/planfix-toggl-client</a></li>
<li><a href="https://github.com/viasite/toggl-button-planfix" target="_blank">https://github.com/viasite/toggl-button-planfix</a></li>
<li><a href="https://github.com/popstas/planfix-go" target="_blank">https://github.com/popstas/planfix-go</a></li>
<li><a href="https://github.com/popstas/go-toggl" target="_blank">https://github.com/popstas/go-toggl</a></li>
</ul>
        </div>
        

<footer>
  <p class="meta">
    
    <time>1 Mar 2018, 20:30</time>
    
      <span class="categories">
        Теги:
        
          <a class="category" href="https://blog.popstas.ru/tags/planfix">planfix</a>  <a class="category" href="https://blog.popstas.ru/tags/toggl">toggl</a>  <a class="category" href="https://blog.popstas.ru/tags/go">go</a>  <a class="category" href="https://blog.popstas.ru/tags/nodejs">nodejs</a>  <a class="category" href="https://blog.popstas.ru/tags/vue">vue</a>  <a class="category" href="https://blog.popstas.ru/tags/onsenui">onsenui</a>  
    
    </span>
  </p>

  
  <div class="sharing">
  
  <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
    <a href="https://www.addtoany.com/share"></a>
    <a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_google_plus"></a><a class="a2a_button_vk"></a><a class="a2a_button_pocket"></a>
  </div>
  <script>
    var a2a_config = a2a_config || {};
    a2a_config.locale = "ru";
    a2a_config.color_main = "undefined";
    a2a_config.color_border = "undefined";
    a2a_config.color_link_text = "undefined";
    a2a_config.color_link_text_hover = "undefined";
    a2a_config.color_bg = "undefined";
    a2a_config.color_arrow = "undefined";
    a2a_config.color_arrow_hover = "undefined";
    a2a_config.prioritize = ["facebook", "twitter", "google_plus", "pocket", "vk"];
  </script>
  <script async src="https://static.addtoany.com/menu/page.js"></script>
  
</div>

  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://blog.popstas.ru/blog/2017/12/31/new-year-2018/" title="Итоги 2017 года">Итоги 2017 года</a>
    

    
      <a class="basic-alignment right" href="https://blog.popstas.ru/blog/2018/04/30/windows-ubuntu-18.04-migrate/" title="Переезд с Windows на Ubuntu 18.04, попытка номер 5">Переезд с Windows на Ubuntu 18.04, попытка номер 5</a>
    
  </p>
      <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'popstas';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/popstas/" title="https://github.com/popstas/"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/popstas/" title="https://twitter.com/popstas/"><i class="fa fa-twitter fa-3x"></i></a>
       
      
      
      
      
      
      
      <a target="_blank" href="tg://resolve?domain=popstas" title="popstas"><i class="fa fa-telegram fa-3x"></i></a>
      <a target="_blank" href="mailto:popstas@gmail.com" title="popstas@gmail.com"><i class="fa fa-at fa-3x"></i></a>

    
    
    </li>
  </ul>

  

  

  
  
  
    
      <section class="even">
        <h4>Последние посты:</h4>
        <ul id="recent_posts">
          
            <li class="post">
              <a href="/blog/2019/12/02/smarthome-node-red-2019/">Мой умный дом 2019: Sonoff, ESP8266, MQTT, Node-red, Алиса</a>
            </li>
          
            <li class="post">
              <a href="/blog/2019/04/06/ilife-a9s-stress-test/">Сколько раз нужно пропылесосить ковёр, чтобы полностью очистить от пыли? Продолжение теста пылесоса ILIFE a9s</a>
            </li>
          
            <li class="post">
              <a href="/blog/2019/04/04/robot-vacuum-cleaner-ilife-a9s-test/">Мини обзор и тестирование робота-пылесоса ILIFE a9s: автоматическая уборка квартиры с коврами</a>
            </li>
          
            <li class="post">
              <a href="/blog/2019/03/17/new-year-2018/">Итоги 2018 года</a>
            </li>
          
            <li class="post">
              <a href="/blog/2018/12/30/my-github-2018/">Мой Github 2018</a>
            </li>
          
        </ul>
      </section>
    
  

  

  
</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2015-2019 Stanislav Popov -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WPJWVXB');</script>
  




<script type="text/javascript" >
  (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
  m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
  (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  ym(51681281, "init", {
       id:51681281,
       clickmap:true,
       trackLinks:true,
       accurateTrackBounce:true,
       webvisor:true
  });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/51681281" style="position:absolute; left:-9999px;" alt="" /></div></noscript>


</body>
</html>

